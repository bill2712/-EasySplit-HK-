import { User, Expense, Transaction } from "../types";

export const generateSummaryMessage = async (
  users: User[],
  expenses: Expense[],
  transactions: Transaction[],
): Promise<string> => {
  // Format data
  const userMap = new Map(users.map((u) => [u.id, u.name]));

  const totalSpent = expenses.reduce((sum, e) => sum + e.amount, 0);

  const transactionList = transactions
    .map(
      (t) =>
        `ğŸ‘‰ ${userMap.get(t.fromId)} çµ¦ (Pay) ${userMap.get(t.toId)}: $${t.amount.toFixed(2)}`,
    )
    .join("\n");

  const date = new Date().toLocaleDateString("zh-HK");

  const message = `
ğŸ‘‹ å„ä½ï¼Œé€™æ˜¯æ˜¯æ¬¡æ´»å‹•çš„æ•¸ç›®ç¸½çµ (${date})

ğŸ’° ç¸½æ”¯å‡º Total: $${totalSpent.toFixed(2)}

ğŸ§¾ çµç®—æ–¹æ¡ˆ (Who pays Whom):
${transactionList || "ğŸ‰ ç„¡éœ€è½‰å¸³ï¼Œæ¢æ•¸å·²å¹³ï¼"}

è¨˜å¾— PayMe / FPS ä¿¾è¿”éŒ¢å•¦! ğŸ’¸
Generated by å¤¾éŒ¢æ˜“ (EasySplit HK)
    `.trim();

  return message;
};
